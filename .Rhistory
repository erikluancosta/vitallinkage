mutate(par_1 = cur_group_id() * (N_par > 1),
par_c1 = par_1) |>
arrange(par_1, banco) |>
select(-N_par) |>
ungroup() |>
select(par_1, id_SIH, id_SIM, id_SINAN) |>
right_join(concat_2, by = c('id_SIH', 'id_SIM', 'id_SINAN'))
View(dados)
dados$par_1
tab_1(dados,par_f)
tab_1(dados,par_1)
table(dados$par_1)
teste <- dados |> filter(is.na(par_1))
View(teste)
dados$ds_nome_sound
dados <- dados |>
arrange(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) |>
group_by(dt_nasc, dt_obito, morreu, ds_nome_pac_sound)
View(dados)
# Parte 1
dados <- dados |>
arrange(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) |>
group_by(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) |>
mutate(N_par = ifelse(!is.na(dt_nasc) & !is.na(dt_obito) & !is.na(morreu) & !is.na(soundex_nome) &
((nu_cpf - lag(nu_cpf) == 0) | (nu_cpf - lag(nu_cpf) == nu_cpf) | (nu_cpf - lag(nu_cpf) == lag(nu_cpf))), n(), NA)) |>
ungroup() |>
mutate(par_2 = group_indices(., dt_nasc, dt_obito, morreu, soundex_nome) * (N_par > 1)) |>
filter(!is.na(N_par)) |>
arrange(par_2) |>
select(-N_par) |>
right_join(dados, by = c('id_SIH', 'id_SIM', 'id_SINAN'))
# Parte 1
dados <- dados |>
arrange(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) |>
group_by(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) |>
mutate(N_par = ifelse(!is.na(dt_nasc) & !is.na(dt_obito) & !is.na(morreu) & !is.na(ds_nome_pac_sound) &
((nu_cpf - lag(nu_cpf) == 0) | (nu_cpf - lag(nu_cpf) == nu_cpf) | (nu_cpf - lag(nu_cpf) == lag(nu_cpf))), n(), NA)) |>
ungroup() |>
mutate(par_2 = group_indices(., dt_nasc, dt_obito, morreu, ds_nome_pac_sound) * (N_par > 1)) |>
filter(!is.na(N_par)) |>
arrange(par_2) |>
select(-N_par) |>
right_join(dados, by = c('id_SIH', 'id_SIM', 'id_SINAN'))
dados$nu_doc
concat$id_doc
devtools::load_all(".")
devtools::load_all(".")
dados <- dados |>
vitallinkage::ajuste_doc()
devtools::check()
devtools::load_all(".")
dados <- dados |>
vitallinkage::ajuste_doc()
dados$nu_doc
# Parte 1
dados <- dados |>
arrange(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) |>
group_by(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) |>
mutate(N_par = ifelse(!is.na(dt_nasc) & !is.na(dt_obito) & !is.na(morreu) & !is.na(ds_nome_pac_sound) &
((nu_doc - lag(nu_doc) == 0) | (nu_doc - lag(nu_doc) == nu_doc) | (nu_doc - lag(nu_doc) == lag(nu_doc))), n(), NA)) |>
ungroup() |>
mutate(par_2 = group_indices(., dt_nasc, dt_obito, morreu, ds_nome_pac_sound) * (N_par > 1)) |>
filter(!is.na(N_par)) |>
arrange(par_2) |>
select(-N_par) |>
right_join(dados, by = c('id_SIH', 'id_SIM', 'id_SINAN'))
# Parte 1
dados <- dados |>
arrange(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) |>
group_by(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) |>
mutate(N_par = ifelse(!is.na(dt_nasc) & !is.na(dt_obito) & !is.na(morreu) & !is.na(ds_nome_pac_sound) &
((nu_doc - lag(nu_doc) == 0) | (nu_doc - lag(nu_doc) == nu_doc) | (nu_doc - lag(nu_doc) == lag(nu_doc))), n(), NA)) |>
ungroup() |>
mutate(par_2 = group_indices(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) * (N_par > 1)) |>
filter(!is.na(N_par)) |>
arrange(par_2) |>
select(-N_par) |>
right_join(dados, by = c('id_SIH', 'id_SIM', 'id_SINAN'))
# Parte 1
dados <- dados |>
arrange(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) |>
group_by(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) |>
mutate(N_par = ifelse(
!is.na(dt_nasc) & !is.na(dt_obito) & !is.na(morreu) & !is.na(ds_nome_pac_sound) &
((nu_doc - lag(nu_doc) == 0) | (nu_doc - lag(nu_doc) == nu_doc) | (nu_doc - lag(nu_doc) == lag(nu_doc))), n(), NA
)) |>
ungroup() |>
mutate(
dt_nasc_str = as.character(dt_nasc),  # Convert date to character
dt_obito_str = as.character(dt_obito),  # Convert date to character
par_2 = group_indices(dt_nasc_str, dt_obito_str, morreu, ds_nome_pac_sound) * (N_par > 1)
) |>
filter(!is.na(N_par)) |>
arrange(par_2) |>
select(-N_par, -dt_nasc_str, -dt_obito_str) |>
right_join(dados, by = c('id_SIH', 'id_SIM', 'id_SINAN'))
# Parte 1
dados <- dados |>
arrange(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) |>
group_by(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) |>
mutate(
N_par = ifelse(
!is.na(dt_nasc) & !is.na(dt_obito) & !is.na(morreu) & !is.na(ds_nome_pac_sound) &
((nu_doc - lag(nu_doc) == 0) | (nu_doc - lag(nu_doc) == nu_doc) | (nu_doc - lag(nu_doc) == lag(nu_doc))),
n(), NA
),
par_2 = row_number() * (sum(!is.na(N_par) & N_par > 1) > 0)
) |>
ungroup() |>
filter(!is.na(N_par)) |>
arrange(par_2) |>
select(-N_par) |>
right_join(dados, by = c('id_SIH', 'id_SIM', 'id_SINAN'))
View(dados)
a <- dados |> select(par_1.x, par_1.y)
View(a)
regra_2 <- concat_2 |>
arrange(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) |>
group_by(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) |>
mutate(
N_par = ifelse(
!is.na(dt_nasc) & !is.na(dt_obito) & !is.na(morreu) & !is.na(ds_nome_pac_sound) &
((nu_doc - lag(nu_doc) == 0) | (nu_doc - lag(nu_doc) == nu_doc) | (nu_doc - lag(nu_doc) == lag(nu_doc))),
n(), NA
),
par_2 = row_number() * (sum(!is.na(N_par) & N_par > 1) > 0)
)  |>
filter(!is.na(N_par)) |>
mutate(par_1 = cur_group_id() * (N_par > 1),
par_c1 = par_1) |>
arrange(par_1, banco) |>
select(-N_par) |>
ungroup() |>
select(par_1, id_SIH, id_SIM, id_SINAN) |>
right_join(concat_2, by = c('id_SIH', 'id_SIM', 'id_SINAN'))
concat_2$nu_doc
concat_2$dados
dados <- dados |>
vitallinkage::ajuste_doc()
dados$
#########################
regra_2 <- dados |>
arrange(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) |>
group_by(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) |>
mutate(
N_par = ifelse(
!is.na(dt_nasc) & !is.na(dt_obito) & !is.na(morreu) & !is.na(ds_nome_pac_sound) &
((nu_doc - lag(nu_doc) == 0) | (nu_doc - lag(nu_doc) == nu_doc) | (nu_doc - lag(nu_doc) == lag(nu_doc))),
n(), NA
),
par_2 = row_number() * (sum(!is.na(N_par) & N_par > 1) > 0)
)  |>
filter(!is.na(N_par)) |>
mutate(par_1 = cur_group_id() * (N_par > 1),
par_c1 = par_1) |>
arrange(par_1, banco) |>
select(-N_par) |>
ungroup() |>
select(par_1, id_SIH, id_SIM, id_SINAN) |>
right_join(concat_2, by = c('id_SIH', 'id_SIM', 'id_SINAN'))
concat <- bind_rows(list_of_dfs)
list_of_dfs <- list(sih,sim,sinan)  # Add more data frames if needed
concat <- bind_rows(list_of_dfs)
rm(list_of_dfs)
concat <-
concat |> vitallinkage::ajuste_data(2)
concat$nu_cns <- as.integer(concat$nu_cns)
concat$nu_cns <- as.integer(concat$nu_cns)
concat$cd_autorizador_doc <- as.integer(concat$cd_autorizador_doc)
concat_2 <- subset(concat, grepl("^A", ds_nome_pac, ignore.case = TRUE))
dados$
#########################
regra_2 <- concat_2 |>
arrange(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) |>
group_by(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) |>
mutate(
N_par = ifelse(
!is.na(dt_nasc) & !is.na(dt_obito) & !is.na(morreu) & !is.na(ds_nome_pac_sound) &
((nu_doc - lag(nu_doc) == 0) | (nu_doc - lag(nu_doc) == nu_doc) | (nu_doc - lag(nu_doc) == lag(nu_doc))),
n(), NA
),
par_2 = row_number() * (sum(!is.na(N_par) & N_par > 1) > 0)
)  |>
filter(!is.na(N_par)) |>
mutate(par_1 = cur_group_id() * (N_par > 1),
par_c1 = par_1) |>
arrange(par_1, banco) |>
select(-N_par) |>
ungroup() |>
# select(par_1, id_SIH, id_SIM, id_SINAN) |>
# right_join(concat_2, by = c('id_SIH', 'id_SIM', 'id_SINAN'))
##########################
dados$dt_nasc
dados$
#########################
regra_2 <- concat_2 |>
arrange(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) |>
group_by(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) |>
mutate(
N_par = ifelse(
!is.na(dt_nasc) & !is.na(dt_obito) & !is.na(morreu) & !is.na(ds_nome_pac_sound) &
((nu_doc - lag(nu_doc) == 0) | (nu_doc - lag(nu_doc) == nu_doc) | (nu_doc - lag(nu_doc) == lag(nu_doc))),
n(), NA
),
par_2 = row_number() * (sum(!is.na(N_par) & N_par > 1) > 0)
)  |>
filter(!is.na(N_par)) |>
mutate(par_1 = cur_group_id() * (N_par > 1),
par_c1 = par_1) |>
arrange(par_1, banco) |>
select(-N_par) |>
ungroup() |>
# select(par_1, id_SIH, id_SIM, id_SINAN) |>
# right_join(concat_2, by = c('id_SIH', 'id_SIM', 'id_SINAN'))
##########################
dados$dt_nasc
dados$
#########################
regra_2 <- concat_2 |>
arrange(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) |>
group_by(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) |>
mutate(
N_par = ifelse(
!is.na(dt_nasc) & !is.na(dt_obito) & !is.na(morreu) & !is.na(ds_nome_pac_sound) &
((nu_doc - lag(nu_doc) == 0) | (nu_doc - lag(nu_doc) == nu_doc) | (nu_doc - lag(nu_doc) == lag(nu_doc))),
n(), NA
),
par_2 = row_number() * (sum(!is.na(N_par) & N_par > 1) > 0)
)  |>
filter(!is.na(N_par)) |>
mutate(par_1 = cur_group_id() * (N_par > 1),
par_c1 = par_1) |>
arrange(par_1, banco) |>
select(-N_par) |>
ungroup() #|>
regra_2 <- concat_2 |>
arrange(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) |>
group_by(dt_nasc, dt_obito, morreu, ds_nome_pac_sound)
View(regra_2)
dados$
#########################
regra_2 <- concat_2 |>
arrange(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) |>
group_by(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) |>
mutate(
N_par = ifelse(
!is.na(dt_nasc) & !is.na(dt_obito) & !is.na(morreu) & !is.na(ds_nome_pac_sound) &
((nu_doc == lag(nu_doc)) | (nu_doc == lead(nu_doc))),
n(), NA
),
par_2 = row_number() * (sum(!is.na(N_par) & N_par > 1) > 0)
)  |>
filter(!is.na(N_par)) |>
mutate(par_1 = cur_group_id() * (N_par > 1),
par_c1 = par_1) |>
arrange(par_1, banco) |>
select(-N_par) |>
ungroup() #|>
regra_2 <- concat_2 |>
arrange(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) |>
group_by(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) |>
mutate(
N_par = ifelse(
!is.na(dt_nasc) & !is.na(dt_obito) & !is.na(morreu) & !is.na(ds_nome_pac_sound) &
((nu_doc == lag(nu_doc)) | (nu_doc == lead(nu_doc))),
n(), NA
),
par_2 = row_number() * (sum(!is.na(N_par) & N_par > 1) > 0)
)  |>
filter(!is.na(N_par)) |>
mutate(par_1 = cur_group_id() * (N_par > 1),
par_c1 = par_1) |>
arrange(par_1, banco)
regra_2 <- concat_2 |>
arrange(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) |>
group_by(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) |>
mutate(
N_par = ifelse(
!is.na(dt_nasc) & !is.na(dt_obito) & !is.na(morreu) & !is.na(ds_nome_pac_sound) &
((nu_doc == lag(nu_doc)) | (nu_doc == lead(nu_doc))),
n(), NA
),
par_2 = row_number() * (sum(!is.na(N_par) & N_par > 1) > 0)
)
View(regra_2)
regra_2$par_2
table(regra_2$par_2)
dados$nu_cns.x
concat_2 <- subset(concat, grepl("^A", ds_nome_pac, ignore.case = TRUE))
dados <- concat_2
dados$nu_cns.x
dados$nu_cns
dados <- concat_2 |>
arrange(ds_nome_pac, dt_nasc) |>
group_by(ds_nome_pac, dt_nasc) |>
mutate(N_par = ifelse(!is.na(dt_nasc) & !is.na(ds_nome_pac) &
((ds_nome_pac == lag(ds_nome_pac)) | (ds_nome_pac == lead(ds_nome_pac))), n(), NA)) |>
filter(!is.na(N_par)) |>
mutate(par_1 = cur_group_id() * (N_par > 1),
par_c1 = par_1) |>
arrange(par_1, banco) |>
select(-N_par) |>
ungroup() |>
select(par_1, id_SIH, id_SIM, id_SINAN) |>
right_join(concat_2, by = c('id_SIH', 'id_SIM', 'id_SINAN'))
View(dados)
regra_2 <- concat_2 |>
arrange(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) |>
group_by(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) |>
mutate(N_par = ifelse(!is.na(dt_nasc) & !is.na(ds_nome_pac_sound) &
((ds_nome_pac_sound == lag(ds_nome_pac_sound)) | (ds_nome_pac_sound == lead(ds_nome_pac_sound))), n(), NA)) |>
filter(!is.na(N_par)) |>
mutate(par_1 = cur_group_id() * (N_par > 1),
par_c1 = par_1) |>
arrange(par_1, banco) |>
select(-N_par) |>
ungroup() |>
select(par_1, id_SIH, id_SIM, id_SINAN) |>
right_join(concat_2, by = c('id_SIH', 'id_SIM', 'id_SINAN'))
View(regra_2)
View(dados)
a <- dados |> filter(id_SIH%in%c('SIH_20719_2417102530359','SIH_20741_2417102530854', 'SIH_28250_2417102548069'))
View(a)
a <- dados |> filter(par_1%in%c(3118))
View(a)
a <- dados |> filter(id_SIH%in%c('SIH_50393_2419103290109'))
View(a)
a <- dados |> filter(id_SIH%in%c(3134))
a <- dados |> filter(par_f%in%c(3134))
a <- dados |> filter(par_f==3134)
View(dados)
a <- dados |> filter(par_1%in%c(3134))
concat_2 <- subset(concat, grepl("^A", ds_nome_pac, ignore.case = TRUE))
regra_1 <- concat_2 |>
arrange(ds_nome_pac, dt_nasc) |>
group_by(ds_nome_pac, dt_nasc) |>
mutate(N_par = ifelse(!is.na(dt_nasc) & !is.na(ds_nome_pac) &
((ds_nome_pac == lag(ds_nome_pac)) | (ds_nome_pac == lead(ds_nome_pac))), n(), NA)) |>
filter(!is.na(N_par)) |>
mutate(par_1 = cur_group_id() * (N_par > 1),
par_c1 = par_1) |>
arrange(par_1, banco) |>
select(-N_par) |>
ungroup() |>
select(par_1, id_SIH, id_SIM, id_SINAN)
regra_2 <- regra_1 |>
arrange(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) |>
group_by(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) |>
mutate(N_par = ifelse(!is.na(dt_nasc) & !is.na(ds_nome_pac_sound) &
((ds_nome_pac_sound == lag(ds_nome_pac_sound)) | (ds_nome_pac_sound == lead(ds_nome_pac_sound))), n(), NA)) |>
filter(!is.na(N_par)) |>
mutate(par_1 = ifelse(!is.na(par_1), par_1, cur_group_id()),
par_c1 = par_1) |>
arrange(par_1, banco) |>
select(-N_par) |>
ungroup() |>
select(par_1, id_SIH, id_SIM, id_SINAN) |>
right_join(concat_2, by = c('id_SIH', 'id_SIM', 'id_SINAN'))
View(regra_1)
regra_1 <- concat_2 |>
arrange(ds_nome_pac, dt_nasc) |>
group_by(ds_nome_pac, dt_nasc) |>
mutate(N_par = ifelse(!is.na(dt_nasc) & !is.na(ds_nome_pac) &
((ds_nome_pac == lag(ds_nome_pac)) | (ds_nome_pac == lead(ds_nome_pac))), n(), NA)) |>
filter(!is.na(N_par)) |>
mutate(par_1 = cur_group_id() * (N_par > 1),
par_c1 = par_1) |>
arrange(par_1, banco) |>
select(-N_par) |>
ungroup()
regra_1 <- concat_2 |>
arrange(ds_nome_pac, dt_nasc) |>
group_by(ds_nome_pac, dt_nasc) |>
mutate(N_par = ifelse(!is.na(dt_nasc) & !is.na(ds_nome_pac) &
((ds_nome_pac == lag(ds_nome_pac)) | (ds_nome_pac == lead(ds_nome_pac))), n(), NA)) |>
filter(!is.na(N_par)) |>
mutate(par_1 = cur_group_id() * (N_par > 1),
par_c1 = par_1) |>
arrange(par_1, banco) |>
select(-N_par) |>
ungroup() |>
select(par_1, id_SIH, id_SIM, id_SINAN) |>
right_join(concat_2, by = c('id_SIH', 'id_SIM', 'id_SINAN'))
View(regra_1)
regra_2 <- regra_1 |>
arrange(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) |>
group_by(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) |>
mutate(N_par = ifelse(!is.na(dt_nasc) & !is.na(ds_nome_pac_sound) &
((ds_nome_pac_sound == lag(ds_nome_pac_sound)) | (ds_nome_pac_sound == lead(ds_nome_pac_sound))), n(), NA)) |>
filter(!is.na(N_par)) |>
mutate(par_1 = ifelse(!is.na(par_1), par_1, cur_group_id()),
par_c1 = par_1) |>
arrange(par_1, banco) |>
select(-N_par) |>
ungroup() |>
select(par_1, id_SIH, id_SIM, id_SINAN) |>
right_join(concat_2, by = c('id_SIH', 'id_SIM', 'id_SINAN'))
View(regra_2)
regra_1 |> distinct(par_1)
regra_1 |> distinct(par_1) |> nrow()
regra_2 |> distinct(par_1) |> nrow()
regra_2 <- regra_1 |>
arrange(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) |>
group_by(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) |>
mutate(N_par = ifelse(!is.na(dt_nasc) & !is.na(ds_nome_pac_sound) &
((ds_nome_pac_sound == lag(ds_nome_pac_sound)) | (ds_nome_pac_sound == lead(ds_nome_pac_sound))), n(), NA)) |>
filter(!is.na(N_par)) |>
mutate(par_1 = ifelse(!is.na(par_1), par_1, cur_group_id()),
par_c1 = par_1) |>
arrange(par_1, banco) |>
select(-N_par) |>
ungroup() |>
select(par_1, id_SIH, id_SIM, id_SINAN) |>
right_join(regra_1, by = c('id_SIH', 'id_SIM', 'id_SINAN'))
regra_2 |> distinct(par_1) |> nrow()
regra_2 <- regra_1 |>
arrange(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) |>
group_by(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) |>
mutate(N_par = ifelse(!is.na(dt_nasc) & !is.na(ds_nome_pac_sound) &
((ds_nome_pac_sound == lag(ds_nome_pac_sound)) | (ds_nome_pac_sound == lead(ds_nome_pac_sound))), n(), NA)) |>
filter(!is.na(N_par)) |>
mutate(par_1 = ifelse(!is.na(par_1), par_1, cur_group_id()),
par_c1 = par_1) |>
arrange(par_1, banco) |>
select(-N_par) |>
ungroup() #|>
regra_2 |> distinct() |> nrow()
regra_1 |> distinct(par_1) |> nrow()
View(regra_2)
View(concat)
View(dados)
regra_1 <- concat_2 |>
arrange(ds_nome_pac, dt_nasc) |>
group_by(ds_nome_pac, dt_nasc) |>
mutate(N_par = ifelse(!is.na(dt_nasc) & !is.na(ds_nome_pac) &
((ds_nome_pac == lag(ds_nome_pac)) | (ds_nome_pac == lead(ds_nome_pac))), n(), NA)) |>
filter(!is.na(N_par)) |>
mutate(par_1 = cur_group_id() * (N_par > 1),
par_c1 = par_1) |>
arrange(par_1, banco) |>
select(-N_par) |>
mutate(regra1 = 1) |>
ungroup() |>
select(par_1, id_SIH, id_SIM, id_SINAN, regra1) |>
right_join(concat_2, by = c('id_SIH', 'id_SIM', 'id_SINAN'))
regra_2 <- regra_1 |>
arrange(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) |>
group_by(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) |>
mutate(N_par = ifelse(!is.na(dt_nasc) & !is.na(ds_nome_pac_sound) &
((ds_nome_pac_sound == lag(ds_nome_pac_sound)) | (ds_nome_pac_sound == lead(ds_nome_pac_sound))), n(), NA)) |>
filter(!is.na(N_par)) |>
mutate(par_1 = ifelse(!is.na(par_1), par_1, cur_group_id()),
par_c1 = par_1) |>
arrange(par_1, banco) |>
select(-N_par) |>
mutate(regra2 = 1) |>
ungroup() |> #|>
#  select(par_1, id_SIH, id_SIM, id_SINAN)
# Verifique se os códigos de par_1 são únicos
table(regra_2$par_1)
regra_2 |> distinct() |> nrow()
rm(regra_2)
regra_2 <- regra_1 |>
arrange(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) |>
group_by(dt_nasc, dt_obito, morreu, ds_nome_pac_sound) |>
mutate(N_par = ifelse(!is.na(dt_nasc) & !is.na(ds_nome_pac_sound) &
((ds_nome_pac_sound == lag(ds_nome_pac_sound)) | (ds_nome_pac_sound == lead(ds_nome_pac_sound))), n(), NA)) |>
filter(!is.na(N_par)) |>
mutate(par_1 = ifelse(!is.na(par_1), par_1, cur_group_id()),
par_c1 = par_1) |>
arrange(par_1, banco) |>
select(-N_par) |>
mutate(regra2 = 1) |>
ungroup() |> #|>
#  select(par_1, id_SIH, id_SIM, id_SINAN)
# Verifique se os códigos de par_1 são únicos
table(regra_2$par_1)
library(readstata13)
library(tidyverse)
library(pdftools)
library(data.table)
library(dplyr)
library(readxl)
library(foreign)
library(stringi)
library(SoundexBR) #soundex
library(janitor)
library(lubridate)
library(writexl)
library(vitaltable)
devtools::load_all(".")
# Record linkage
########
### SIM
########
# leitura da base especifica para cada caso
# Minha pasta com os dados
path <- 'C:/vitalstrategies/data_sicence/TCC/SCRIPTS_LINKAGE/Erik/SIM'
# lista de arquivos com fim .DBF
dbf_files <- list.files(path, pattern = "\\.DBF$", full.names = TRUE)
# Data Frame para adicionar os dados carregados
sim_raw <- data.frame()
# Loop para carregar e concatenar os dbf
for (file in dbf_files) {
# Lendo arquivo DBF
sim_temp <- read.dbf(file) |>
mutate(ANO=substr(DTOBITO,5,8))
sim_raw <- bind_rows(sim_raw,sim_temp)
rm(sim_temp)
}
sim <- vitallinkage::padroniza_SIM(sim_raw)
sim <- vitallinkage::padroniza_SIM(sim_raw)
